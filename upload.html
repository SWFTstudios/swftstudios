<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Thought Sessions | SWFT Studios</title>
  <meta content="Share quick thoughts, ideas, and files to your knowledge graph" name="description">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <link href="css/normalize.css" rel="stylesheet" type="text/css">
  <link href="css/components.css" rel="stylesheet" type="text/css">
  <link href="css/swftstudios000.css" rel="stylesheet" type="text/css">
  <link href="css/upload.css" rel="stylesheet" type="text/css">
  <link href="css/settings.css" rel="stylesheet" type="text/css">
  <link href="images/favicon.webp" rel="stylesheet" type="image/x-icon">
  <link href="images/webclip.webp" rel="apple-touch-icon">
  <!-- Marked.js for markdown parsing -->
  <script src="https://cdn.jsdelivr.net/npm/marked@11/marked.min.js"></script>
  <!-- CodeMirror 5 for rich markdown editor -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5/lib/codemirror.css">
  <script src="https://cdn.jsdelivr.net/npm/codemirror@5/lib/codemirror.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/codemirror@5/mode/markdown/markdown.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/codemirror@5/addon/edit/closebrackets.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/codemirror@5/addon/edit/matchbrackets.js"></script>
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-F2BXR858CL"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-F2BXR858CL');
  </script>
</head>
<body>
  <div class="page-wrapper chat-layout">
    <!-- Navigation -->
    <header class="chat-nav">
      <div class="chat-nav-container">
        <a href="index.html" class="nav_logo">SWFT <span class="skinny">STUDIOS</span></a>
        <nav class="chat-nav-links">
          <button type="button" id="theme-toggle" class="chat-nav-btn" aria-label="Toggle theme" title="Toggle light/dark mode">
            <svg id="theme-icon-sun" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
              <circle cx="12" cy="12" r="5"></circle>
              <line x1="12" y1="1" x2="12" y2="3"></line>
              <line x1="12" y1="21" x2="12" y2="23"></line>
              <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
              <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
              <line x1="1" y1="12" x2="3" y2="12"></line>
              <line x1="21" y1="12" x2="23" y2="12"></line>
              <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
              <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
            <svg id="theme-icon-moon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
          </button>
          <a href="blog.html" class="chat-nav-link">View Published Sessions</a>
          <button type="button" id="sign-out-btn" class="chat-nav-btn">Sign Out</button>
        </nav>
      </div>
    </header>

    <main class="chat-main">
      <!-- Thought Sessions Sidebar -->
      <aside class="threads-sidebar">
        <div class="threads-header">
          <h2 class="threads-title">Thought Sessions</h2>
          <button type="button" id="new-note-btn" class="new-thread-btn" aria-label="New Thought Session">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            <span class="new-note-btn-text">New Session</span>
          </button>
        </div>
        <div class="threads-list" id="notes-list">
          <!-- Thought Sessions will be rendered here -->
        </div>
        <div class="user-profile" id="user-profile">
          <div class="user-profile-avatar" id="user-profile-avatar">
            <!-- User initials will be inserted here -->
          </div>
          <div class="user-profile-info">
            <div class="user-profile-name" id="user-profile-name">Loading...</div>
            <div class="user-profile-email" id="user-profile-email">Loading...</div>
          </div>
        </div>
      </aside>

      <!-- Messages Area -->
      <div class="messages-container">
        <!-- Messages Header -->
        <div class="messages-header">
          <div class="messages-header-info">
            <h1 class="messages-title" id="current-note-title">Select a Thought Session to start</h1>
            <p class="messages-subtitle" id="current-note-subtitle">Create or select a Thought Session to begin your conversation</p>
          </div>
          <div class="messages-header-actions">
            <div class="github-sync-status" id="github-sync-status" hidden>
              <span class="sync-status-icon" id="sync-status-icon"></span>
              <span class="sync-status-text" id="sync-status-text">Auto-sync enabled</span>
              <span class="sync-status-detail" id="sync-status-detail"></span>
              <button type="button" class="sync-btn" id="sync-now-btn" title="Sync to GitHub">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
                </svg>
              </button>
              <span class="sync-tooltip" id="sync-tooltip" hidden>GitHub not synced</span>
            </div>
          </div>
        </div>

        <!-- Messages List -->
        <div class="messages-list" id="messages-list">
          <div class="messages-empty" id="messages-empty-state">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" opacity="0.3">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
            <p id="empty-state-message">Select a note or create a new one to start</p>
          </div>
        </div>

        <!-- Upload Progress Indicator -->
        <div class="upload-progress-container" id="upload-progress-container" hidden>
          <!-- Upload progress items will be inserted here -->
        </div>

        <!-- Message Input Area -->
        <div class="message-input-container">
          <!-- Tag Suggestions (Auto-tagging) -->
          <div class="tag-suggestions" id="tag-suggestions" hidden>
            <div class="tag-suggestions-header">
              <span>Suggested tags:</span>
              <button type="button" class="tag-suggestions-close" id="close-tag-suggestions">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
              </button>
            </div>
            <div class="tag-suggestions-list" id="tag-suggestions-list"></div>
          </div>

          <!-- Voice Recording UI -->
          <div class="voice-recording-container" id="voice-recording-container" hidden>
            <div class="voice-recording-header">
              <div class="voice-recording-status">
                <div class="voice-recording-indicator" id="voice-recording-indicator"></div>
                <span id="voice-recording-timer">00:00</span>
              </div>
              <button type="button" class="voice-recording-stop" id="voice-recording-stop" aria-label="Stop recording">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="6" y="6" width="12" height="12" rx="2"></rect>
                </svg>
              </button>
            </div>
            <div class="voice-recording-waveform" id="voice-recording-waveform">
              <!-- Waveform visualization will be inserted here -->
            </div>
            <div class="voice-recording-transcription-preview" id="voice-recording-transcription-preview" hidden>
              <div class="transcription-preview-header">
                <span>Transcription Preview</span>
              </div>
              <div class="transcription-preview-content" id="transcription-preview-content"></div>
            </div>
          </div>

          <!-- Input Area -->
          <form class="message-input-form" id="message-form">
            <!-- File Attachments Display -->
            <div class="message-attachments" id="message-attachments" hidden></div>

            <!-- Input Row -->
            <div class="message-input-row">
              <!-- Attachment Button -->
              <button type="button" class="attachment-btn" id="attachment-btn" aria-label="Attach file">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path>
                </svg>
              </button>

              <!-- Text Input -->
              <div class="message-input-wrapper" id="editor-wrapper">
                <textarea 
                  id="message-input" 
                  class="message-input"
                  placeholder="Type a note... (Markdown supported). Drag and drop files here!"
                  rows="1"
                ></textarea>
              </div>
              
              <!-- Audio Recording Button -->
              <button type="button" class="audio-record-btn" id="audio-record-btn" aria-label="Record audio">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                  <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                  <line x1="12" y1="19" x2="12" y2="23"></line>
                  <line x1="8" y1="23" x2="16" y2="23"></line>
                </svg>
              </button>

              <!-- Send Button -->
              <button type="submit" class="send-btn" id="send-btn" aria-label="Send">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="22" y1="2" x2="11" y2="13"></line>
                  <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                </svg>
              </button>
            </div>

            <!-- Hidden File Inputs -->
            <input type="file" id="image-file-input" accept="image/*" hidden multiple>
            <input type="file" id="audio-file-input" accept="audio/*" hidden multiple>
            <input type="file" id="video-file-input" accept="video/*" hidden multiple>
            <input type="file" id="file-input" accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.rtf,.txt,.md,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation,application/rtf,text/plain,text/markdown" hidden multiple>
          </form>

          <!-- Attachment Menu -->
          <div class="attachment-menu" id="attachment-menu" hidden>
            <button type="button" class="attachment-menu-item" data-type="image">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                <polyline points="21 15 16 10 5 21"></polyline>
              </svg>
              <span>Image</span>
            </button>
            <button type="button" class="attachment-menu-item" data-type="audio">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                <line x1="12" y1="19" x2="12" y2="23"></line>
                <line x1="8" y1="23" x2="16" y2="23"></line>
              </svg>
              <span>Audio File</span>
            </button>
            <button type="button" class="attachment-menu-item" data-type="voice-record">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                <line x1="12" y1="19" x2="12" y2="23"></line>
                <line x1="8" y1="23" x2="16" y2="23"></line>
              </svg>
              <span>Record Audio</span>
            </button>
            <button type="button" class="attachment-menu-item" data-type="video-record" id="video-record-btn">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M23 7l-7 5 7 5V7z"></path>
                <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                <circle cx="8.5" cy="12" r="1.5" fill="currentColor"></circle>
              </svg>
              <span>Record Video</span>
            </button>
            <button type="button" class="attachment-menu-item" data-type="video">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polygon points="23 7 16 12 23 17 23 7"></polygon>
                <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
              </svg>
              <span>Video File</span>
            </button>
            <button type="button" class="attachment-menu-item" data-type="file">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path>
                <polyline points="13 2 13 9 20 9"></polyline>
              </svg>
              <span>File</span>
            </button>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Attachment Preview Modal -->
  <div class="attachment-modal" id="attachment-modal" hidden>
    <div class="attachment-modal-backdrop"></div>
    <div class="attachment-modal-content">
      <div class="attachment-modal-header">
        <h3 class="attachment-modal-title" id="attachment-modal-title">Attachment Preview</h3>
        <button type="button" class="attachment-modal-close" id="attachment-modal-close" aria-label="Close">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="attachment-modal-body" id="attachment-modal-body">
        <!-- Preview content will be inserted here -->
      </div>
      <div class="attachment-modal-footer">
        <a href="#" class="attachment-download-btn" id="attachment-download-btn" download>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
          </svg>
          Download
        </a>
      </div>
    </div>
  </div>

  <!-- Transcript Modal -->
  <div class="transcript-modal" id="transcript-modal" hidden>
    <div class="transcript-modal-backdrop"></div>
    <div class="transcript-modal-content">
      <div class="transcript-modal-header">
        <h3 class="transcript-modal-title">Audio Transcript</h3>
        <button type="button" class="transcript-modal-close" id="transcript-modal-close" aria-label="Close">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="transcript-modal-body" id="transcript-modal-body">
        <!-- Transcript content will be inserted here -->
      </div>
    </div>
  </div>

  <!-- Supabase Client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <!-- Theme Manager -->
  <script src="js/theme.js"></script>
  <!-- Auth Script -->
  <script src="js/auth.js"></script>
  <!-- Thread Manager -->
  <script src="js/thread-manager.js"></script>
  <!-- Auto Tagger -->
  <script src="js/auto-tagger.js"></script>
  <!-- Settings -->
  <script src="js/settings.js"></script>
  <!-- Graph Customizer -->
  <script src="js/graph-customizer.js"></script>
  <!-- Upload Script -->
  <script src="js/upload.js?v=2"></script>
  
  <script>
    // Initialize settings when ready
    (async function() {
      if (window.SWFTAuth && window.SWFTAuth.supabase && window.Settings) {
        const { data: { session } } = await window.SWFTAuth.supabase.auth.getSession();
        if (session && session.user) {
          await window.Settings.init(window.SWFTAuth.supabase, session.user);
        }
      }
    })();
  </script>
</body>
</html>
